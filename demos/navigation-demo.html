<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导航系统演示 - AI编程工具中心</title>
    <link rel="stylesheet" href="../src/styles/main.css">
    <link rel="stylesheet" href="../src/styles/theme-switcher.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- 主题预加载脚本，防止主题闪烁 -->
    <script>
        (function() {
            try {
                // 立即读取并应用保存的主题，避免闪烁
                const savedTheme = localStorage.getItem('ai-tools-theme');
                if (savedTheme && savedTheme !== 'default') {
                    // 立即添加主题类到html元素
                    document.documentElement.className = 'theme-' + savedTheme;
                    
                    // 立即创建并添加主题CSS链接
                    const themeLink = document.createElement('link');
                    themeLink.id = 'theme-css-preload';
                    themeLink.rel = 'stylesheet';
                    themeLink.href = '../src/themes/' + savedTheme + '/theme.css';
                    document.head.appendChild(themeLink);
                }
            } catch (e) {
                // 静默处理错误，不影响页面加载
                console.warn('主题预加载失败:', e);
            }
        })();
    </script>
    
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 100px auto 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .demo-title {
            text-align: center;
            color: #333;
            margin-bottom: 2rem;
        }
        
        .demo-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .demo-section h3 {
            color: #495057;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .feature-list li::before {
            content: '✅';
            font-size: 1rem;
        }
        
        .control-panel {
            background: #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .control-group {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group label {
            font-weight: 500;
            min-width: 100px;
        }
        
        .control-group button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .control-group button:hover {
            background: #0056b3;
        }
        
        .status-display {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 0.75rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .test-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .test-info strong {
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .demo-container {
                margin: 20px auto 0;
                padding: 1rem;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- 页面头部 -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-robot"></i>
                    <span>AI编程工具中心</span>
                </div>
                <nav class="main-nav">
                    <!-- 导航将通过JavaScript动态生成 -->
                </nav>
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 演示内容 -->
    <div class="demo-container">
        <h1 class="demo-title">
            <i class="fas fa-compass"></i>
            导航系统演示
        </h1>

        <!-- 功能介绍 -->
        <div class="demo-section">
            <h3><i class="fas fa-star"></i> 核心功能</h3>
            <ul class="feature-list">
                <li>配置化导航系统，支持动态添加/删除功能按钮</li>
                <li>完善的移动端响应式设计和下拉菜单</li>
                <li>智能的优先级管理，移动端自动隐藏低优先级项目</li>
                <li>开发小工具下拉菜单，支持分类管理</li>
                <li>搜索功能集成，支持移动端优化</li>
                <li>键盘快捷键支持（ESC关闭菜单）</li>
                <li>平滑动画效果和无障碍访问支持</li>
            </ul>
        </div>

        <!-- 测试说明 -->
        <div class="test-info">
            <strong>测试说明：</strong>
            <br>• 调整浏览器窗口大小测试响应式效果
            <br>• 在移动端（宽度 ≤ 768px）点击右上角汉堡菜单图标
            <br>• 悬停或点击"开发小工具"查看下拉菜单
            <br>• 按ESC键关闭打开的菜单
            <br>• 使用下方控制面板测试动态配置功能
        </div>

        <!-- 控制面板 -->
        <div class="demo-section">
            <h3><i class="fas fa-sliders-h"></i> 控制面板</h3>
            <div class="control-panel">
                <div class="control-group">
                    <label>导航状态：</label>
                    <button onclick="window.navDemo?.getStatus()">获取状态</button>
                    <button onclick="window.navDemo?.toggleMobileMenu()">切换移动端菜单</button>
                </div>
                
                <div class="control-group">
                    <label>断点测试：</label>
                    <button onclick="window.navDemo.simulateResize(1200)">桌面端 (1200px)</button>
                    <button onclick="window.navDemo.simulateResize(768)">平板端 (768px)</button>
                    <button onclick="window.navDemo.simulateResize(480)">移动端 (480px)</button>
                </div>
                
                <div class="control-group">
                    <label>配置管理：</label>
                    <button onclick="window.navDemo.showConfig()">查看配置</button>
                    <button onclick="window.navDemo.addTestItem()">添加测试项</button>
                    <button onclick="window.navDemo.removeTestItem()">移除测试项</button>
                </div>
            </div>
        </div>

        <!-- 状态显示 -->
        <div class="demo-section">
            <h3><i class="fas fa-info-circle"></i> 状态信息</h3>
            <div class="status-display" id="statusDisplay">
                等待导航系统初始化...
            </div>
        </div>

        <!-- 配置展示 -->
        <div class="demo-section">
            <h3><i class="fas fa-cog"></i> 当前配置</h3>
            <div class="status-display" id="configDisplay">
                点击"查看配置"按钮显示当前导航配置
            </div>
        </div>
    </div>

    <script type="module">
        import { NavigationManager } from '../src/js/managers/navigation-manager.js';
        import { 
            getEnabledNavigation, 
            getEnabledDevtools,
            MOBILE_CONFIG 
        } from '../src/js/config/navigation-config.js';

        class NavigationDemo {
            constructor() {
                this.navigationManager = null;
                this.testItemAdded = false;
            }

            async initialize() {
                try {
                    console.log('🎬 初始化导航演示...');
                    
                    // 初始化导航管理器
                    this.navigationManager = new NavigationManager();
                    await this.navigationManager.initialize();
                    
                    // 设置演示控制
                    this.setupDemoControls();
                    
                    // 更新状态显示
                    this.updateStatusDisplay();
                    
                    console.log('✅ 导航演示初始化完成');
                    
                } catch (error) {
                    console.error('❌ 导航演示初始化失败:', error);
                    this.updateStatusDisplay('初始化失败: ' + error.message);
                }
            }

            setupDemoControls() {
                // 监听窗口大小变化
                window.addEventListener('resize', () => {
                    setTimeout(() => this.updateStatusDisplay(), 100);
                });
                
                // 监听导航状态变化
                const observer = new MutationObserver(() => {
                    this.updateStatusDisplay();
                });
                
                const mainNav = document.querySelector('.main-nav');
                if (mainNav) {
                    observer.observe(mainNav, { 
                        attributes: true, 
                        attributeFilter: ['class'] 
                    });
                }
            }

            getStatus() {
                if (!this.navigationManager) {
                    console.log('❌ 导航管理器未初始化');
                    return;
                }
                
                const status = this.navigationManager.getStatus();
                console.log('📊 导航状态:', status);
                this.updateStatusDisplay();
                return status;
            }

            toggleMobileMenu() {
                if (!this.navigationManager) {
                    console.log('❌ 导航管理器未初始化');
                    return;
                }
                
                // 模拟点击移动端菜单按钮
                const mobileBtn = document.querySelector('.mobile-menu-btn');
                if (mobileBtn) {
                    mobileBtn.click();
                    console.log('📱 切换移动端菜单');
                }
            }

            simulateResize(width) {
                console.log(`📐 模拟窗口大小变化: ${width}px`);
                
                // 暂时修改窗口的 innerWidth 属性
                Object.defineProperty(window, 'innerWidth', {
                    writable: true,
                    configurable: true,
                    value: width
                });
                
                // 触发 resize 事件
                window.dispatchEvent(new Event('resize'));
                
                // 延迟恢复原始值
                setTimeout(() => {
                    Object.defineProperty(window, 'innerWidth', {
                        writable: true,
                        configurable: true,
                        value: document.documentElement.clientWidth
                    });
                    window.dispatchEvent(new Event('resize'));
                }, 3000);
                
                this.updateStatusDisplay();
            }

            showConfig() {
                const navigation = getEnabledNavigation();
                const devtools = getEnabledDevtools();
                
                const configInfo = {
                    主导航项目: navigation.length,
                    开发工具项目: devtools.length,
                    移动端断点: MOBILE_CONFIG.breakpoint + 'px',
                    导航配置: navigation.map(item => ({
                        名称: item.name,
                        类型: item.type,
                        优先级: item.mobile?.priority,
                        移动端显示: item.mobile?.showInCollapsed
                    })),
                    开发工具配置: devtools.map(tool => ({
                        名称: tool.name,
                        分类: tool.category,
                        链接: tool.href
                    }))
                };
                
                console.log('⚙️ 导航配置:', configInfo);
                this.updateConfigDisplay(configInfo);
            }

            addTestItem() {
                if (this.testItemAdded) {
                    console.log('⚠️ 测试项目已经添加');
                    return;
                }
                
                console.log('➕ 添加测试导航项');
                
                // 这里可以扩展为真正的动态添加功能
                // 目前只是演示概念
                const testItem = {
                    id: 'test-item',
                    name: '测试功能',
                    href: '#test',
                    icon: 'fas fa-flask',
                    type: 'internal',
                    order: 999,
                    enabled: true,
                    description: '动态添加的测试功能',
                    mobile: {
                        priority: 'low',
                        showInCollapsed: false
                    }
                };
                
                if (this.navigationManager) {
                    this.navigationManager.addNavigationItem(testItem);
                    this.testItemAdded = true;
                    console.log('✅ 测试项目已添加');
                }
            }

            removeTestItem() {
                if (!this.testItemAdded) {
                    console.log('⚠️ 没有测试项目需要移除');
                    return;
                }
                
                console.log('➖ 移除测试导航项');
                
                if (this.navigationManager) {
                    this.navigationManager.removeNavigationItem('test-item');
                    this.testItemAdded = false;
                    console.log('✅ 测试项目已移除');
                }
            }

            updateStatusDisplay(customMessage = null) {
                const statusElement = document.getElementById('statusDisplay');
                if (!statusElement) return;
                
                if (customMessage) {
                    statusElement.textContent = customMessage;
                    return;
                }
                
                if (!this.navigationManager) {
                    statusElement.textContent = '导航管理器未初始化';
                    return;
                }
                
                const status = this.navigationManager.getStatus();
                const statusInfo = `
导航状态: ${status.initialized ? '已初始化' : '未初始化'}
移动端菜单: ${status.mobileMenuOpen ? '已打开' : '已关闭'}
当前断点: ${status.currentBreakpoint}
窗口宽度: ${window.innerWidth}px
导航项目数: ${status.navigationItems}
开发工具数: ${status.devtoolItems}
最后更新: ${new Date().toLocaleTimeString()}`;
                
                statusElement.textContent = statusInfo;
            }

            updateConfigDisplay(config) {
                const configElement = document.getElementById('configDisplay');
                if (!configElement) return;
                
                configElement.textContent = JSON.stringify(config, null, 2);
            }
        }

        // 创建全局演示实例
        window.navDemo = new NavigationDemo();

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            window.navDemo.initialize();
        });

        // 定时更新状态显示
        setInterval(() => {
            if (window.navDemo && window.navDemo.navigationManager) {
                window.navDemo.updateStatusDisplay();
            }
        }, 5000);
    </script>
</body>
</html> 